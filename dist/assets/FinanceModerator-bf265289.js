import{j as s,i as R,r as h,Q as b}from"./index-134e5887.js";import{a1 as H,a2 as K,a3 as X,a4 as Q,a5 as q}from"./finance-manager-api-fb59fb59.js";import{u,b as I,c as k,f as B}from"./AssestsBaseUrl-075cad6e.js";import{B as F,M as z,L as J}from"./UserMemberProfileWrapper-3712cae2.js";import{A as Z}from"./AddButton-60130181.js";import{C as U,U as f,s as y,A as M}from"./FinanceManager-bea28cd5.js";import{U as S}from"./UserMemberContentWrapper-eca956b4.js";import{u as V,n as w,c as Y}from"./StaffMemberConfig-c9e9b23c.js";import{M as D}from"./Modal-1da1be7e.js";import{C as W}from"./CreateButton-26558557.js";import{s as v}from"./PlateformUser.module-0e3694bb.js";import"./decrypt-8baef3ab.js";import"./MethodType-30df8d44.js";import"./UiTab.module-f6b989ec.js";import"./FormInputView-80b5cd6b.js";import"./dayjs.min-92d8bb0f.js";import"./auth-api-6dacce9f.js";import"./checkingRequiredField-382733fa.js";import"./Utils.module-b6acf444.js";const ss="_moderator_container_1ytv1_1",cs="_moderator_container_title_1ytv1_4",ns="_add_new_moderator_1ytv1_10",is="_moderator_card_1ytv1_20",_s="_moderator_card_text_container_1ytv1_42",es="_menu_icon_1ytv1_63",ts="_assign_role_container_1ytv1_70",ls="_assign_role_title_1ytv1_77",as="_selected_staff_container_1ytv1_84",os="_selected_staff_text_1ytv1_96",hs="_assign_btn_1ytv1_110",xs="_select_application_btn_1ytv1_125",rs="_select_btn_1ytv1_144",Es="_application_card_1ytv1_160",Cs="_application_card_active_1ytv1_177",js="_application_card_text_1ytv1_180",ps="_application_card_text_bottom_1ytv1_193",ds="_modal_container_1ytv1_207",As="_modal_container_header_1ytv1_216",g={moderator_container:ss,moderator_container_title:cs,add_new_moderator:ns,moderator_card:is,moderator_card_text_container:_s,menu_icon:es,assign_role_container:ts,assign_role_title:ls,selected_staff_container:as,selected_staff_text:os,assign_btn:hs,select_application_btn:xs,select_btn:rs,application_card:Es,application_card_active:Cs,application_card_text:js,application_card_text_bottom:ps,modal_container:ds,modal_container_header:As},gs=({onCloseEdit:c,setActivePopup:x,selectedStaff:i,moderatorState:n,onSelectRole:a,onUpdateModerator:p})=>{const{t:o}=u();return s.jsx(s.Fragment,{children:s.jsx(D,{onClose:c,children:s.jsxs("div",{className:g.modal_container,children:[s.jsx(S,{children:s.jsx("div",{className:g.modal_container_header,children:s.jsx("h6",{children:o("update_role_to_moderator")})})}),s.jsx(F,{}),s.jsxs(S,{customStyle:{paddingTop:"0"},children:[s.jsxs("section",{className:g.selected_staff_container,onClick:()=>x("OPEN_STAFF_LIST"),style:{cursor:"pointer"},children:[s.jsx("img",{src:i!=null&&i.staffProfilePhoto?`${R}/${i==null?void 0:i.staffProfilePhoto}`:`${I}/feed-user-avatar.svg`,alt:"staff profile avatar"}),s.jsxs("div",{className:g.selected_staff_text,children:[s.jsx("h6",{children:`${i==null?void 0:i.staffFirstName} ${(i==null?void 0:i.staffMiddleName)??""} ${i==null?void 0:i.staffLastName}`}),s.jsxs("p",{children:[o("index_number")," "," : ",i==null?void 0:i.staffROLLNO]})]})]}),s.jsx(U,{selectLabel:o("select_role_of_moderator"),selectedValue:o("please_select_role"),options:["Cash Receipt Section","Inventories Section","Fees Master Section","Payroll Section","Deposit Section","Bank Account Section","Data Export Authority"],defalutValue:(n==null?void 0:n.mod_role)==="CASH_RECEIPT_ACCESS"?"Cash Receipt Section":(n==null?void 0:n.mod_role)==="INVENTORY_ACCESS"?"Inventories Section":(n==null?void 0:n.mod_role)==="FEE_MASTER_ACCESS"?"Fees Master Section":(n==null?void 0:n.mod_role)==="PAYROLL_ACCESS"?"Payroll Section":(n==null?void 0:n.mod_role)==="DEPOSIT_ACCESS"?"Deposit Section":(n==null?void 0:n.mod_role)==="BANK_ACCOUNT_ACCESS"?"Bank Account Section":(n==null?void 0:n.mod_role)==="DATA_EXPORT_ACCESS"?"Data Export Authority":"",onClick:a}),s.jsx(W,{label:"update",onAction:p})]})]})})})},L=({staff:c,selectedId:x,onSelect:i})=>{const{t:n}=u(),a=()=>{i(c)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:v.assign_show_list_each,style:x===(c==null?void 0:c._id)?{backgroundColor:"rgba(75, 26, 133, 0.1)"}:null,onClick:a,children:[s.jsx("img",{src:c!=null&&c.staffProfilePhoto?`${R}/${c.staffProfilePhoto}`:`${I}/feed-staff-avatar.svg`,alt:"profile avatar"}),s.jsxs("div",{className:v.assign_each_paragraph,children:[s.jsx("h6",{children:`${(c==null?void 0:c.staffFirstName)??""} ${(c==null?void 0:c.staffMiddleName)??""} ${(c==null?void 0:c.staffLastName)??""}`}),s.jsxs("p",{children:[n("index")," "," : ",c==null?void 0:c.staffRollNo]})]})]}),s.jsx(F,{customStyleBorder:{margin:"0"}})]})},Ns=({onClose:c,selectedId:x,onSelectStaff:i,instituteId:n})=>{const{t:a}=u(),[p,o]=h.useState(""),[j,E]=h.useState(1),[l,A]=h.useState(!0),[t,d]=V({skip:p}),{instituteAllStaff:_,instituteAllStaffLoading:r}=H({data:{id:n,page:j,limit:10,search:p},skip:!n});h.useEffect(()=>{d&&l&&E(e=>e+1)},[d,l]),h.useEffect(()=>{_!=null&&_.length&&w(_==null?void 0:_.length,A)},[_==null?void 0:_.length]);const N=h.useCallback(Y(e=>o(e),500),[]),T=e=>{N(e.target.value)},m=e=>{x===(e==null?void 0:e._id)||i(e)};return s.jsx(D,{onClose:c,children:s.jsxs("div",{className:v.modal_container,children:[s.jsx(S,{children:s.jsxs("div",{className:v.modal_container_outer_header,children:[s.jsx("div",{className:v.modal_container_header,children:s.jsx("h6",{children:a("staff_list")})}),s.jsx("img",{src:`${k}/close.svg`,alt:"close icon",onClick:c})]})}),s.jsx(F,{}),s.jsxs(S,{customStyle:{paddingBottom:"1rem"},children:[s.jsxs("div",{className:v.assign_search_container,style:{marginBottom:"1rem"},children:[s.jsx("input",{type:"text",placeholder:a("search"),className:v.assign_search_input,onChange:T}),s.jsx("img",{src:`${B}/navbar-search.svg`,alt:"search icon"})]}),_==null?void 0:_.map((e,P)=>(_==null?void 0:_.length)===P+1?s.jsx("div",{ref:t,children:s.jsx(L,{staff:e,selectedId:x,onSelect:m})},e==null?void 0:e._id):s.jsx(L,{staff:e,selectedId:x,onSelect:m},e==null?void 0:e._id))]})]})})},G=({instituteId:c,fid:x,onClose:i,openModeratorMenu:n,openAs:a,onEdit:p})=>{var P;const{t:o}=u(),[j,E]=h.useState(a==="EDIT"?"PREVIEW_FORM":"OPEN_STAFF_LIST"),[l,A]=h.useState(a==="EDIT"?n==null?void 0:n.access_staff:""),[t,d]=h.useState({mod_role:a==="EDIT"?n==null?void 0:n.access_role:"",sid:a==="EDIT"?(P=n==null?void 0:n.access_staff)==null?void 0:P._id:""}),[_]=K();h.useEffect(()=>{var C;a==="EDIT"&&(A(n==null?void 0:n.access_staff),d({mod_role:n==null?void 0:n.access_role,sid:(C=n==null?void 0:n.access_staff)==null?void 0:C._id}),E("PREVIEW_FORM"))},[a]);const r=C=>{A(C),d(O=>({...O,sid:C==null?void 0:C._id})),E(a==="EDIT"?"PREVIEW_FORM":"ASSIGN_ROLE")},N=C=>{d(O=>({...O,mod_role:C==="Cash Receipt Section"?"CASH_RECEIPT_ACCESS":C==="Inventories Section"?"INVENTORY_ACCESS":C==="Fees Master Section"?"FEE_MASTER_ACCESS":C==="Payroll Section"?"PAYROLL_ACCESS":C==="Deposit Section"?"DEPOSIT_ACCESS":C==="Bank Account Section"?"BANK_ACCOUNT_ACCESS":C==="Data Export Authority"?"DATA_EXPORT_ACCESS":""}))},T=()=>{E("LOADING"),_({fid:x,addModerator:t}).then(()=>{E(""),i()}).catch({})},m=()=>{p(t)},e=()=>{i()};return s.jsxs(s.Fragment,{children:[j==="OPEN_STAFF_LIST"&&s.jsx(Ns,{onSelectStaff:r,onClose:i,instituteId:c}),j==="ASSIGN_ROLE"&&s.jsx(s.Fragment,{children:s.jsx(D,{onClose:i,children:s.jsxs("div",{className:g.modal_container,children:[s.jsx(S,{children:s.jsx("div",{className:g.modal_container_header,children:s.jsx("h6",{children:o("assign_role_to_moderator")})})}),s.jsx(F,{}),s.jsxs(S,{customStyle:{paddingTop:"0"},children:[s.jsxs("section",{className:g.selected_staff_container,children:[s.jsx("img",{src:l!=null&&l.staffProfilePhoto?`${R}/${l==null?void 0:l.staffProfilePhoto}`:`${I}/feed-user-avatar.svg`,alt:"staff profile avatar"}),s.jsxs("div",{className:g.selected_staff_text,children:[s.jsx("h6",{children:`${l==null?void 0:l.staffFirstName} ${(l==null?void 0:l.staffMiddleName)??""} ${l==null?void 0:l.staffLastName}`}),s.jsxs("p",{children:[o("index_no"),l==null?void 0:l.staffROLLNO]})]})]}),s.jsx(U,{selectLabel:o("select_role_of_moderator"),selectedValue:o("please_select_role"),options:["Cash Receipt Section","Inventories Section","Fees Master Section","Payroll Section","Deposit Section","Bank Account Section","Data Export Authority"],defalutValue:(t==null?void 0:t.mod_role)==="CASH_RECEIPT_ACCESS"?"Cash Receipt Section":(t==null?void 0:t.mod_role)==="INVENTORY_ACCESS"?"Inventories Section":(t==null?void 0:t.mod_role)==="FEE_MASTER_ACCESS"?"Fees Master Section":(t==null?void 0:t.mod_role)==="PAYROLL_ACCESS"?"Payroll Section":(t==null?void 0:t.mod_role)==="DEPOSIT_ACCESS"?"Deposit Section":(t==null?void 0:t.mod_role)==="BANK_ACCOUNT_ACCESS"?"Bank Account Section":(t==null?void 0:t.mod_role)==="DATA_EXPORT_ACCESS"?"Data Export Authority":"",onClick:N}),s.jsx(W,{label:"assign",onAction:T})]}),j==="LOADING"&&s.jsx(b,{})]})})}),j==="PREVIEW_FORM"&&s.jsx(gs,{onCloseEdit:e,setActivePopup:E,selectedStaff:l,moderatorState:t,onSelectRole:N,onUpdateModerator:m}),j==="LOADING"&&s.jsx(b,{})]})},Ss=({onClose:c,financeId:x,openModeratorMenu:i,instituteId:n})=>{const{t:a}=u(),[p,o]=h.useState(!1),[j,E]=h.useState(!1),[l]=X(),[A]=Q(),t=()=>{o(r=>!r),l({fid:x,modId:i==null?void 0:i._id}).then(()=>{c(),o(r=>!r)}).catch({})},d=r=>{o(N=>!N),_(),A({modId:i==null?void 0:i._id,updateModerator:{role:r==null?void 0:r.mod_role,staffId:r==null?void 0:r.sid}}).then(()=>{o(N=>!N),c()}).catch({})},_=()=>{E(r=>!r)};return s.jsx(s.Fragment,{children:j?s.jsx(G,{onClose:_,onEdit:d,openModeratorMenu:i,openAs:"EDIT",fid:x,instituteId:n}):s.jsxs(z,{onClose:c,disabled:p,children:[s.jsx("h6",{onClick:_,children:a("edit")}),s.jsx("h6",{onClick:t,children:a("delete")})]})})},$=({moderator:c,instituteId:x,financeId:i})=>{var E,l,A,t,d,_;const{t:n}=u(),[a,p]=h.useState(""),o=()=>{p(c)},j=()=>{p("")};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:g.moderator_card,children:[s.jsx("img",{src:(E=c==null?void 0:c.access_staff)!=null&&E.staffProfilePhoto?`${R}/${(l=c==null?void 0:c.access_staff)==null?void 0:l.staffProfilePhoto}`:`${I}/feed-user-avatar.svg`,alt:"moderator avatar"}),s.jsxs("section",{className:g.moderator_card_text_container,children:[s.jsx("h6",{children:`${(A=c==null?void 0:c.access_staff)==null?void 0:A.staffFirstName} ${((t=c==null?void 0:c.access_staff)==null?void 0:t.staffMiddleName)??""} ${(d=c==null?void 0:c.access_staff)==null?void 0:d.staffLastName}`}),s.jsxs("p",{children:[n("index_number")," "," : ",(_=c==null?void 0:c.access_staff)==null?void 0:_.staffROLLNO]}),s.jsx("p",{children:(c==null?void 0:c.access_role)==="CASH_RECEIPT_ACCESS"?"Cash Receipt Section":(c==null?void 0:c.access_role)==="INVENTORY_ACCESS"?"Inventories Section":(c==null?void 0:c.access_role)==="FEE_MASTER_ACCESS"?"Fees Master Section":(c==null?void 0:c.access_role)==="PAYROLL_ACCESS"?"Payroll Section":(c==null?void 0:c.access_role)==="DEPOSIT_ACCESS"?"Deposit Section":(c==null?void 0:c.access_role)==="BANK_ACCOUNT_ACCESS"?"Bank Account Section":(c==null?void 0:c.access_role)==="DATA_EXPORT_ACCESS"?"Data Export Authority":""})]}),s.jsx("img",{src:`${k}/menu.svg`,alt:"menu icon",onClick:o,className:g.menu_icon,title:"Menu"})]}),a&&s.jsx(Ss,{onClose:j,financeId:i,openModeratorMenu:a,instituteId:x})]})},Ys=({fid:c,instituteId:x})=>{const{t:i}=u(),[n,a]=h.useState(""),[p,o]=h.useState(1),[j,E]=h.useState(!0),[l,A]=V({skip:n}),[t,d]=h.useState(!1),{financeModerator:_,financeModeratorLoading:r}=q({data:{fid:c,page:p,limit:10,search:n},skip:!c});h.useEffect(()=>{A&&j&&o(e=>e+1)},[A,j]),h.useEffect(()=>{_!=null&&_.length&&w(_==null?void 0:_.length,E)},[_==null?void 0:_.length]);const N=h.useCallback(Y(e=>a(e),500),[]),T=e=>{N(e.target.value)},m=()=>{d(e=>!e)};return s.jsxs(s.Fragment,{children:[s.jsxs(f,{children:[s.jsx(S,{children:s.jsxs("div",{className:y.fm_header_container,children:[s.jsx("h6",{children:i("finance_moderators")}),s.jsx("div",{className:y.fm_search,children:s.jsx("section",{className:y.fm_search_container,children:s.jsxs("div",{className:y.fm_search_container_inner,children:[s.jsx("img",{className:y.fm_search_icon,alt:"search icon",src:`${B}/navbar-search.svg`}),s.jsx("input",{type:"text",placeholder:i("search"),onChange:T})]})})})]})}),s.jsx(F,{}),s.jsxs(S,{customStyle:{paddingTop:"0.2rem"},children:[s.jsx(M,{children:s.jsx(Z,{label:"add_new_moderator",onAction:m})}),r&&s.jsx(J,{}),_==null?void 0:_.map((e,P)=>(_==null?void 0:_.length)===P+1?s.jsx("div",{ref:l,children:s.jsx($,{moderator:e,financeId:c,instituteId:x})},e==null?void 0:e._id):s.jsx($,{moderator:e,financeId:c,instituteId:x},e==null?void 0:e._id))]})]}),t&&s.jsx(G,{instituteId:x,fid:c,onClose:m})]})};export{Ys as default};
