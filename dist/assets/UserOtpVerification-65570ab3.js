import{a as R,u as W,r as x,j as s}from"./index-4403507e.js";import{G as B,s as v}from"./GetStarted-9010b363.js";import{A as D}from"./AuthCardWrapper-7d03cdd2.js";import{A as G}from"./AuthFormFieldWithIcon-fae3c761.js";import{B as z,N as M}from"./NotifyEvent-ad5291c6.js";import{u as J,a as K}from"./AssestsBaseUrl-0f87f19c.js";import{O as X}from"./OtpResendTimer-d1f2228a.js";import{b as Y,a as Z}from"./auth-api-e89939f9.js";import{d as _}from"./decrypt-5e8ab41f.js";import{a as y}from"./invalidateAuthUsername-b1b2606f.js";import{u as Q}from"./use-login-5fd982e6.js";import"./CreateButton-be4cb7e7.js";import"./Utils.module-b6acf444.js";import"./MethodType-30df8d44.js";const pt=()=>{var O,j,T,C,P,U;const{t:c}=J(),t=R(),S=W(),{existingAccountLogin:$}=Q(),[l,g]=x.useState(""),[q,h]=x.useState(!1),[E,F]=x.useState(""),[I,i]=x.useState({open:!1,msg:"",variant:"error"}),[A]=Y(),[L]=Z(),V=r=>{g(r.target.value)},k=r=>{var d,m,u,p;if(r.preventDefault(),l&&((d=t==null?void 0:t.state)!=null&&d.phoneNumber))if(h(o=>!o),Array.isArray((m=t==null?void 0:t.state)==null?void 0:m.phoneNumber)){let o="";for(let e of(u=t==null?void 0:t.state)==null?void 0:u.phoneNumber)if((e==null?void 0:e.code)===l){o=e==null?void 0:e.phone;break}A({userOtpCode:l,userPhoneNumber:o}).then(e=>{var n,f,b,N;let a=_((n=e==null?void 0:e.data)==null?void 0:n.encrypt);h(H=>!H),(a==null?void 0:a.message)==="Invalid OTP"?i({msg:a==null?void 0:a.message,open:!0,variant:"error"}):((f=a==null?void 0:a.accounts)==null?void 0:f.length)===1?$((b=a==null?void 0:a.accounts)==null?void 0:b[0]):S("/existing-account",{state:{accounts:a==null?void 0:a.accounts,phoneNumber:(N=t==null?void 0:t.state)==null?void 0:N.phoneNumber}})}).catch(e=>{i({msg:`Time out of request with reason ${e}`,open:!0,variant:"error"}),h(a=>!a)})}else A({userOtpCode:l,userPhoneNumber:(p=t==null?void 0:t.state)==null?void 0:p.phoneNumber}).then(o=>{var a,n,f,b;let e=_((a=o==null?void 0:o.data)==null?void 0:a.encrypt);h(N=>!N),(e==null?void 0:e.message)==="Invalid OTP"?i({msg:e==null?void 0:e.message,open:!0,variant:"error"}):((n=e==null?void 0:e.accounts)==null?void 0:n.length)===1?$((f=e==null?void 0:e.accounts)==null?void 0:f[0]):S("/existing-account",{state:{accounts:e==null?void 0:e.accounts,phoneNumber:(b=t==null?void 0:t.state)==null?void 0:b.phoneNumber}})}).catch(o=>{i({msg:`Time out of request with reason ${o}`,open:!0,variant:"error"}),h(e=>!e)});else F({userOtpCode:"* required"})},w=()=>{var r,d;L({userPhoneNumber:`${(r=t==null?void 0:t.state)==null?void 0:r.phoneNumber}`,status:"Not Verified",is_qid:y(`${(d=t==null?void 0:t.state)==null?void 0:d.phoneNumber}`)}).then(m=>{var p,o,e,a,n;let u=_((p=m==null?void 0:m.data)==null?void 0:p.encrypt);u!=null&&u.userPhoneNumber&&i({open:!0,msg:`Code will be resent to xxxx- ${(n=`${(o=t==null?void 0:t.state)==null?void 0:o.phoneNumber}`)==null?void 0:n.substring(((a=`${(e=t==null?void 0:t.state)==null?void 0:e.phoneNumber}`)==null?void 0:a.length)-4)}`,variant:"success"})}).catch(()=>{i({open:!0,msg:"Time out of request...",variant:"error"})})};return s.jsx(B,{children:s.jsx(D,{title:"verification_code",subTitle:`${c("verification_code_note")}${((O=t.state)==null?void 0:O.type)??""}${c("ending")} xxxx - ${(P=`${(j=t==null?void 0:t.state)==null?void 0:j.phoneNumber}`)==null?void 0:P.substring(((C=`${(T=t==null?void 0:t.state)==null?void 0:T.phoneNumber}`)==null?void 0:C.length)-4)}`,subTitleStyle:{fontSize:"0.8rem"},children:s.jsxs("form",{onSubmit:k,className:v.auth_login_form,children:[s.jsx(G,{placeholder:c("verification_code"),fieldIconUrl:`${K}/auth-otp.svg`,maxLength:"4",validate:E.userOtpCode,name:"userOtpCode",value:l,onChange:V}),s.jsx("div",{className:v.auth_footer_container,children:Array.isArray((U=t==null?void 0:t.state)==null?void 0:U.phoneNumber)?null:s.jsxs("p",{className:v.auth_otp_text,children:[c("if_you_did_not_recieve_otp"),s.jsx(X,{onOtpResend:w})]})}),s.jsx(z,{type:"submit",buttonText:c("verify"),disabled:q}),s.jsx(M,{eventState:I,eventStateHandler:i})]})})})};export{pt as default};
